<%- include("./layout/header.ejs");  %>
    <v-main >
        <v-container>
            <v-row class="mb-0 pa-5">
                <v-col
                v-for="(user, i) in users"
                :key="i"
                cols="6"
                >
                
                </v-col>
                <v-card-text>
                    <v-list>
                        
                        <v-expansion-panels>
                            <v-expansion-panel
                                v-for="(year, i) in marks"
                                :key="i"
                                v-if="!(Object.keys(year).length === 0)"
                            >
                                <v-expansion-panel-header flat outlined>
                                    <h4>{{ years[i][0].toUpperCase() + " > " + years[i][1].toUpperCase() + " (" + Object.keys(year).length + ")"}}</h4>
                                </v-expansion-panel-header>
                                <v-expansion-panel-content>
                                    <v-list-item v-if="Object.keys(year).length === 0" class="ml-5 py-0 px-2 mb-2 rounded-lg red white--text elevation-2">
                                        <v-list-item-content>
                                            <v-list-item-title class="font-weight-bold ">
                                                No Marks Found
                                            </v-list-item-title>
                                        </v-list-item-content>
                                    </v-list-item>
        
                                    <v-list-item v-else v-for="(mark,key, i) in year" :key="i" class="ml-5 py-0 px-2 mb-2  elevation-2">
                                        <v-list-item-content v-if="info.role != 'STUDENT'">
                                            <v-list-item-title class="font-weight-bold ">
                                                STUDENT ID: {{ mark[0] }}
                                            </v-list-item-title>
                                        </v-list-item-content>

                                        <v-list-item-content>
                                        <v-list-item-title class="font-weight-bold ">
                                            {{ key.toUpperCase() }}
                                        </v-list-item-title>
                                        </v-list-item-content>
                            
                                        <v-list-item-content>
                                        <v-list-item-title class="font-weight-bold pl-6" :class="(mark[1] >= 10)? 'green--text':'red--text'">
                                            {{ (mark[1].toString().length == 1)? "0" + mark[1]: mark[1] }}/20
                                        </v-list-item-title>
                                        </v-list-item-content>
                            
                                        <v-list-item-action>
                                            <v-btn color="success" :to="`/consultations/${id}`" outlined>
                                              <v-icon class="mr-2">
                                                mdi-pen
                                              </v-icon>
                                              COMPLAINT
                                            </v-btn>
                                        </v-list-item-action>
                                    </v-list-item>
                                
                                </v-expansion-panel-content>

                                </v-expansion-panel>
                                    
                                
                        </v-expansion-panels>
                    </v-list>
                  </v-card-text>
            
            
                  </div>
                </v-card>
            </v-row>
        </v-container>
    </v-main>
    <v-footer padless>
        <v-col
        class="text-center"
        cols="12"
        >
        {{ new Date().getFullYear() }} â€” <strong>By Youcef Hemadou</strong>
        </v-col>
    </v-footer>
</v-app>
    <script src="script/vue.min.js"></script>
    <script src="script/vuetify.min.js"></script>
    <script src="script/axios.min.js"></script>

    <script>
        // import CardInfo from "components/CardInfo"
        // var CardInfo = require("./components/CardInfo")
        var vm =  new Vue({
            el: '#app',
            vuetify: new Vuetify(),
            data:{
                page_name : "MARKS",
                logged : false,
                info:{},
                drawered: true,
                items: [],
                marks_bool:[false,false,false,false,false,false,false,false,false,false],
                years:[["l1","s1"],
                ["l1","s2"],
                ["l2","s1"],
                ["l2","s2"],
                ["l3","s1"],
                ["l3","s2"],
                ["m1","s1"],
                ["m1","s2"],
                ["m2","s1"],
                ["m2","s2"]],
                marks: []
            },
            computed:{
                styleColor(){
                return 'background-image: linear-gradient(270deg,#' + this.secondColor +  ' ,#' + this.firstColor +  ')';
                }

            },
            methods: {
                goto(url){
                    window.location.href = url
                },
                logout() {
                    localStorage.removeItem("token");
                    window.location.href = '/login'
                },
                show_marks(i){
                    this.marks_bool[i] = !this.marks_bool[i]
                }
            },
            async created() {
                if (localStorage.getItem("token") === null) {
                    window.location.href = '/'
                }else{
                    axios.defaults.headers.post['x-access-token'] = localStorage.getItem("token")
                    axios.defaults.headers.common['x-access-token'] = localStorage.getItem("token")
                    axios.get('/api/user/me').then((res) => {
                            // console.log(res.data)
                            this.info = res.data
                            this.logged = true
                            this.items.push(
                                { title: 'Dashboard', icon: 'mdi-view-dashboard', url:"/",selected:false},
                                { title: 'Account', icon: 'mdi-badge-account-horizontal-outline', url:"/profile",selected:false},
                            )
                            if(res.data.user_refere != -1){
                                if(res.data.role.toLowerCase() == "super admin"){
                                    this.items.push(
                                        { title: 'Users', icon: 'mdi-account-supervisor-outline', url:"/users",selected:false},
                                        { title: 'Members', icon: 'mdi-account-group-outline', url:"/members",selected:false},
                                    )
                                }
                                this.items.push(
                                    { title: 'Complaints', icon: 'mdi-alert-circle', url:"/complaints",selected:false},
                                    { title: 'Marks', icon: 'mdi-format-text-variant-outline', url:"/marks",selected:true}
                                )
                            }
                            axios.get('/api/member/me').then((member) => {
                                member.data.member_status.state
                                if(member.data.member_status.state.toLowerCase() == "student"){
                                    this.years.forEach((value,index)=>{
                                        axios.get('/api/mark/me/' + value[0] + '/' + value[1] + '/-1').then((res) => {
                                            if(res.data.ok != 0){
                                                this.marks.push(res.data)
                                            }else{
                                                this.marks.push({})
                                            }
                                        }).catch(
                                            err => {
                                                this.errors = err.response.data.errors
                                                console.log(this.errors)
                                            }
                                        )
                                    })
                                }else if(member.data.member_status.state.toLowerCase() == "teacher"){
                                    this.linked = member.data
                                    this.years.forEach((value,index)=>{
                                        axios.get('/api/mark/me/' + value[0] + '/' + value[1] + '/' + member.data.member_status.subject.toLowerCase()).then((res) => {
                                            if(res.data.ok != 0){
                                                this.marks.push(res.data)
                                            }else{
                                                this.marks.push({})
                                            } 
                                        }).catch(
                                            err => {
                                                this.errors = err.response.data.errors
                                                console.log(this.errors)
                                            }
                                        )
                                    })
                                }

                                    
                            }).catch(
                                    err => {
                                        this.errors = err.response.data.errors
                                        console.log(this.errors)
                                    }
                            )
                    }).catch(
                        err => {
                            this.errors = err.response.data.errors
                            console.log(this.errors)
                        }
                    )
                    
                    
                }
            },

        })
    </script>
    
<%- include("./layout/footer.ejs") %>